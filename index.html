<!DOCTYPE html>
<!-- Chosen Palette: Warm Neutral (Beige/Off-white), Accent (Deep Purple from card), Highlight (Muted Green from card) -->
<!-- Application Structure Plan: A single-page application with a language toggle (AR/EN) and multiple views managed by JavaScript.
    - View 1 (Main Page): Hero section, interactive category cards, comparative charts, "How to Join" section, and footer.
    - View 2 (Inscription Page): A new view that appears when a user selects a category. This page dynamically displays details of the chosen category, collects user information (name, WhatsApp, phone, payment proof), and simulates submission.
    This structure guides the user from exploration to action, providing a dedicated form for each category selection, enhancing user experience and clarity for the registration process. -->
<!-- Visualization & Content Choices:
    - Competition Categories: Interactive HTML/Tailwind cards. Goal: Inform and allow quick comparison. Interaction: Click to navigate to inscription page.
    - Cost vs. Benefit Chart & Chance to Win Chart: Bar charts using Chart.js. Goal: Visually compare data. Interaction: Dynamic update on language toggle.
    - How to Join Steps: HTML/Tailwind numbered steps. Goal: Provide clear instructions. Interaction: Text updated on language toggle.
    - Inscription Form: HTML form with input fields and a file upload. Goal: Collect user data for chosen category. Interaction: Dynamic content based on category selection, form submission handling (now with Firestore).
    - Language Toggle: Button. Goal: Provide multilingual access. Interaction: Click updates all text content across all views and chart labels/titles.
    - All graphics use Chart.js (Canvas) or structured HTML/CSS with Tailwind and Unicode characters/icons. NO SVG graphics used. NO Mermaid JS used. -->
<!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-key="title">Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„ÙƒØ¨Ø±Ù‰ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙˆØ±ØªØ±ÙŠÙ‡Ø§Øª</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #FDFBF7;
            scroll-behavior: smooth;
        }
        .card-category {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer; /* Indicate clickable */
        }
        .card-category:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        @media (min-width: 1024px) {
            .chart-container {
                height: 400px;
            }
        }
        .view-section {
            display: none; /* Hidden by default */
        }
        .view-section.active {
            display: block; /* Shown when active */
        }
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #8b5cf6;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            margin: 0.5rem auto;
            display: none; /* Hidden by default */
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-[#FDFBF7] text-gray-800">

    <nav class="bg-white/80 backdrop-blur-md sticky top-0 z-50 shadow-sm">
        <div class="container mx-auto px-6 py-3 flex justify-between items-center">
            <h1 class="text-xl font-bold text-purple-800" data-key="nav_title">Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„ÙƒØ¨Ø±Ù‰</h1>
            <button id="lang-toggle" class="bg-purple-700 text-white font-bold py-2 px-4 rounded-full hover:bg-purple-800 transition-colors duration-300">
                English
            </button>
        </div>
    </nav>

    <!-- Main Page View -->
    <div id="main-view" class="view-section active">
        <header class="text-center py-16 md:py-24 bg-purple-50">
            <div class="container mx-auto px-6">
                <h2 class="text-4xl md:text-6xl font-extrabold text-purple-900 mb-4" data-key="hero_title">Ø§Ø¯Ø®Ù„ Ø§Ù„Ø³Ø­Ø¨ ÙˆØ§Ø±Ø¨Ø­ Ø¨ÙˆØ±ØªØ±ÙŠÙ‡ ÙÙ†ÙŠ</h2>
                <p class="text-lg md:text-xl text-gray-600 max-w-2xl mx-auto" data-key="hero_subtitle">ÙØ±Øµ Ù…ØªØ¹Ø¯Ø¯Ø© Ù„Ù„ÙÙˆØ² ÙˆØ®ØµÙˆÙ…Ø§Øª Ø­ØµØ±ÙŠØ© Ù„ÙƒÙ„ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†. Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø© Ø§Ù„ØªÙŠ ØªÙ†Ø§Ø³Ø¨Ùƒ ÙˆØ§Ù†Ø¶Ù… Ø¥Ù„ÙŠÙ†Ø§ Ø§Ù„Ø¢Ù†!</p>
                <p id="user-id-display" class="text-sm text-gray-500 mt-4" style="direction: ltr;">User ID: <span class="font-mono text-purple-700">Loading...</span></p>
            </div>
        </header>

        <main class="container mx-auto px-6 py-12">
            <section id="categories" class="my-12">
                <h3 class="text-3xl font-bold text-center mb-10" data-key="categories_title">Ø§Ø®ØªØ± ÙØ¦Ø© Ø§Ø´ØªØ±Ø§ÙƒÙƒ</h3>
                <div class="grid md:grid-cols-3 gap-8">
                    <div class="card-category bg-white p-8 rounded-2xl shadow-lg border-t-4 border-purple-300" data-category="A">
                        <h4 class="text-2xl font-bold text-purple-800 mb-4" data-key="cat_a_title">Ø§Ù„ÙØ¦Ø© Ø£</h4>
                        <p class="text-4xl font-extrabold mb-4" data-key="cat_a_price">5 <span data-key="currency">Ø¯.Ù….</span></p>
                        <ul class="space-y-3 text-gray-700">
                            <li data-key="cat_a_draw">ğŸŸï¸ <span class="font-bold">Ø§Ù„Ø³Ø­Ø¨:</span> ÙØ§Ø¦Ø² ÙˆØ§Ø­Ø¯ Ù„ÙƒÙ„ 100 Ù…Ø´Ø§Ø±Ùƒ</li>
                            <li data-key="cat_a_discount">ğŸ’¸ <span class="font-bold">Ø®ØµÙ…:</span> 25% Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙˆØ±ØªØ±ÙŠÙ‡ (Ù„Ù…Ø¯Ø© 15 ÙŠÙˆÙ…)</li>
                        </ul>
                    </div>
                    <div class="card-category bg-white p-8 rounded-2xl shadow-xl border-t-4 border-purple-600 relative" data-category="B">
                        <span class="absolute top-0 right-0 -mt-3 mr-3 bg-purple-600 text-white text-xs font-bold px-3 py-1 rounded-full uppercase" data-key="popular_badge">Ø§Ù„Ø£ÙƒØ«Ø± Ø´ÙŠÙˆØ¹Ù‹Ø§</span>
                        <h4 class="text-2xl font-bold text-purple-800 mb-4" data-key="cat_b_title">Ø§Ù„ÙØ¦Ø© Ø¨</h4>
                        <p class="text-4xl font-extrabold mb-4" data-key="cat_b_price">10 <span data-key="currency">Ø¯.Ù….</span></p>
                        <ul class="space-y-3 text-gray-700">
                            <li data-key="cat_b_draw">ğŸ¯ <span class="font-bold">Ø§Ù„Ø³Ø­Ø¨:</span> Ø¹Ù†Ø¯ ÙˆØµÙˆÙ„ 50 Ù…Ø´Ø§Ø±ÙƒÙ‹Ø§</li>
                            <li data-key="cat_b_discount">ğŸ’° <span class="font-bold">Ø®ØµÙ…:</span> 35% Ø¹Ù„Ù‰ ÙƒÙ„ Ø·Ù„Ø¨ Ø¨ÙˆØ±ØªØ±ÙŠÙ‡</li>
                        </ul>
                    </div>
                    <div class="card-category bg-white p-8 rounded-2xl shadow-lg border-t-4 border-green-400" data-category="C">
                        <h4 class="text-2xl font-bold text-purple-800 mb-4" data-key="cat_c_title">Ø§Ù„ÙØ¦Ø© Ø¨Ø±Ùˆ-Ù…Ø§ÙƒØ³</h4>
                        <p class="text-4xl font-extrabold mb-4" data-key="cat_c_price">20 <span data-key="currency">Ø¯.Ù….</span></p>
                        <ul class="space-y-3 text-gray-700">
                            <li data-key="cat_c_draw">â­ <span class="font-bold">Ø§Ù„Ø³Ø­Ø¨:</span> Ø¹Ù†Ø¯ Ø¨Ù„ÙˆØº 30 Ù…Ø´Ø§Ø±ÙƒÙ‹Ø§ ÙÙ‚Ø·</li>
                            <li data-key="cat_c_discount">ğŸ’ <span class="font-bold">Ø®ØµÙ…:</span> 50% Ø¹Ù„Ù‰ Ø·Ù„Ø¨ Ø§Ù„Ø¨ÙˆØ±ØªØ±ÙŠÙ‡</li>
                        </ul>
                    </div>
                </div>
            </section>

            <section id="charts" class="my-20">
                <h3 class="text-3xl font-bold text-center mb-10" data-key="charts_title">Ù…Ù‚Ø§Ø±Ù†Ø© Ø¨ÙŠÙ† Ø§Ù„ÙØ¦Ø§Øª</h3>
                <div class="grid md:grid-cols-2 gap-12">
                    <div>
                        <h4 class="text-xl font-bold text-center mb-4" data-key="chart1_title">Ø§Ù„ØªÙƒÙ„ÙØ© Ù…Ù‚Ø§Ø¨Ù„ Ø§Ù„Ø®ØµÙ…</h4>
                        <div class="chart-container bg-white p-4 rounded-xl shadow-md">
                            <canvas id="costBenefitChart"></canvas>
                        </div>
                    </div>
                    <div>
                        <h4 class="text-xl font-bold text-center mb-4" data-key="chart2_title">ÙØ±ØµØ© Ø§Ù„ÙÙˆØ² (Ù…Ø´Ø§Ø±ÙƒÙˆÙ† Ø£Ù‚Ù„ = ÙØ±ØµØ© Ø£ÙƒØ¨Ø±)</h4>
                        <div class="chart-container bg-white p-4 rounded-xl shadow-md">
                            <canvas id="chanceToWinChart"></canvas>
                        </div>
                    </div>
                </div>
            </section>

            <section id="how-to-join" class="my-20 text-center">
                <h3 class="text-3xl font-bold text-center mb-10" data-key="join_title">ÙƒÙŠÙ ØªØ´Ø§Ø±ÙƒØŸ</h3>
                <div class="grid md:grid-cols-3 gap-8 max-w-4xl mx-auto">
                    <div class="flex flex-col items-center">
                        <div class="bg-purple-600 text-white w-16 h-16 rounded-full flex items-center justify-center text-2xl font-bold mb-4">1</div>
                        <h4 class="text-xl font-bold mb-2" data-key="step1_title">Ø§Ø®ØªØ± ÙØ¦ØªÙƒ</h4>
                        <p class="text-gray-600" data-key="step1_desc">Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø© Ø§Ù„ØªÙŠ ØªÙ†Ø§Ø³Ø¨Ùƒ Ù…Ù† Ø¨ÙŠÙ† Ø§Ù„ÙØ¦Ø§Øª Ø§Ù„Ø«Ù„Ø§Ø« Ø§Ù„Ù…ØªØ§Ø­Ø©.</p>
                    </div>
                    <div class="flex flex-col items-center">
                        <div class="bg-purple-600 text-white w-16 h-16 rounded-full flex items-center justify-center text-2xl font-bold mb-4">2</div>
                        <h4 class="text-xl font-bold mb-2" data-key="step2_title">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</h4>
                        <p class="text-gray-600" data-key="step2_desc">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ ÙˆØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ù„Ø¥ØªÙ…Ø§Ù… Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¯ÙØ¹.</p>
                    </div>
                    <div class="flex flex-col items-center">
                        <div class="bg-purple-600 text-white w-16 h-16 rounded-full flex items-center justify-center text-2xl font-bold mb-4">3</div>
                        <h4 class="text-xl font-bold mb-2" data-key="step3_title">Ø§Ø¯Ø®Ù„ Ø§Ù„Ø³Ø­Ø¨!</h4>
                        <p class="text-gray-600" data-key="step3_desc">Ø¨Ù…Ø¬Ø±Ø¯ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¯ÙØ¹ØŒ Ø£Ù†Øª Ù…Ø´ØªØ±Ùƒ Ø±Ø³Ù…ÙŠÙ‹Ø§ ÙÙŠ Ø§Ù„Ø³Ø­Ø¨. Ø­Ø¸Ù‹Ø§ Ù…ÙˆÙÙ‚Ù‹Ø§!</p>
                    </div>
                </div>
            </section>
        </main>

        <footer class="bg-purple-900 text-white text-center py-12">
            <div class="container mx-auto px-6">
                <h3 class="text-2xl font-bold mb-4" data-key="footer_title">Ù‡Ù„ Ø£Ù†Øª Ù…Ø³ØªØ¹Ø¯ Ù„Ù„Ø§Ù†Ø¶Ù…Ø§Ù…ØŸ</h3>
                <p class="text-purple-200 mb-8" data-key="footer_subtitle">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ø§Ù„Ø¢Ù† Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ø¨Ø¯Ø¡ Ø§Ø´ØªØ±Ø§ÙƒÙƒ Ø£Ùˆ ØªØ§Ø¨Ø¹Ù†Ø§ Ø¹Ù„Ù‰ Ø§Ù†Ø³ØªØºØ±Ø§Ù…!</p>
                <div class="flex justify-center gap-6">
                    <a href="https://wa.me/212691700038" target="_blank" class="bg-green-500 text-white font-bold py-3 px-8 rounded-full hover:bg-green-600 transition-transform transform hover:scale-105" data-key="whatsapp_btn">
                        ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
                    </a>
                    <a href="https://instagram.com/ali01art" target="_blank" class="bg-pink-600 text-white font-bold py-3 px-8 rounded-full hover:bg-pink-700 transition-transform transform hover:scale-105" data-key="instagram_btn">
                        ØªØ§Ø¨Ø¹Ù†Ø§ Ø¹Ù„Ù‰ Ø§Ù†Ø³ØªØºØ±Ø§Ù…
                    </a>
                </div>
            </div>
        </footer>
    </div>

    <!-- Inscription Page View -->
    <div id="inscription-view" class="view-section bg-purple-50 py-16 md:py-24 px-6">
        <div class="container mx-auto max-w-2xl bg-white p-8 rounded-2xl shadow-xl">
            <button id="back-to-main-btn" class="mb-6 bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-full hover:bg-gray-300 transition-colors duration-300">
                â† <span data-key="back_button_text">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
            </button>

            <h3 class="text-3xl font-bold text-center text-purple-800 mb-8" data-key="inscription_title">Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</h3>
            
            <div class="mb-8 p-4 bg-purple-100 rounded-lg border border-purple-200">
                <h4 class="text-xl font-bold text-purple-700 mb-2" data-key="chosen_category_summary_title">Ø§Ù„ÙØ¦Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©:</h4>
                <p class="text-lg text-gray-700 mb-1">
                    <span class="font-bold" data-key="inscription_category_name"></span> (<span data-key="inscription_category_price"></span>)
                </p>
                <p class="text-md text-gray-600" data-key="inscription_category_discount"></p>
            </div>

            <form id="inscription-form" class="space-y-6">
                <div>
                    <label for="full-name" class="block text-lg font-semibold text-gray-700 mb-2" data-key="form_full_name_label">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„:</label>
                    <input type="text" id="full-name" name="fullName" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500" required>
                </div>
                <div>
                    <label for="whatsapp-number" class="block text-lg font-semibold text-gray-700 mb-2" data-key="form_whatsapp_label">Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨:</label>
                    <input type="tel" id="whatsapp-number" name="whatsappNumber" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500" required>
                </div>
                <div>
                    <label for="phone-number" class="block text-lg font-semibold text-gray-700 mb-2" data-key="form_phone_label">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
                    <input type="tel" id="phone-number" name="phoneNumber" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500">
                </div>
                <div>
                    <label for="payment-proof" class="block text-lg font-semibold text-gray-700 mb-2" data-key="form_payment_proof_label">ØµÙˆØ±Ø© Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ø¯ÙØ¹:</label>
                    <input type="file" id="payment-proof" name="paymentProof" accept="image/*" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500" required>
                    <p class="text-sm text-gray-500 mt-1" data-key="form_payment_proof_hint">ÙŠØ±Ø¬Ù‰ Ø¥Ø±Ø³Ø§Ù„ ØµÙˆØ±Ø© ÙˆØ§Ø¶Ø­Ø© Ù„Ø¥ÙŠØµØ§Ù„ Ø§Ù„Ø¯ÙØ¹.</p>
                </div>
                
                <button type="submit" class="w-full bg-purple-700 text-white font-bold py-3 px-6 rounded-full hover:bg-purple-800 transition-transform transform hover:scale-105" data-key="form_submit_button">
                    ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
                </button>
            </form>

            <div id="submission-message" class="mt-8 p-4 bg-green-100 text-green-800 rounded-lg hidden" data-key="submission_success_message">
                <p class="font-bold" data-key="submission_success_title">ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ø´ØªØ±Ø§ÙƒÙƒ Ø¨Ù†Ø¬Ø§Ø­!</p>
                <p data-key="submission_success_details"></p>
                <p class="mt-2" data-key="submission_contact_info">Ø³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹ Ø¹Ù„Ù‰ Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ø°ÙŠ Ù‚Ø¯Ù…ØªÙ‡.</p>
            </div>
             <div id="submission-error-message" class="mt-8 p-4 bg-red-100 text-red-800 rounded-lg hidden" data-key="submission_error_message">
                <p class="font-bold" data-key="submission_error_title">Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„!</p>
                <p data-key="submission_error_details">ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.</p>
            </div>
             <div id="submission-loading-message" class="mt-8 p-4 bg-blue-100 text-blue-800 rounded-lg hidden">
                <p class="font-bold">Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ...</p>
                <div class="loading-spinner"></div>
            </div>
        </div>
    </div>

    <script type="module">
        // Firebase imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Firebase variables (Canvas environment provides these)
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db, auth, userId;
        let isAuthReady = false; // Flag to ensure Firestore operations only happen after auth

        // Initialize Firebase and Auth
        async function initializeFirebaseAndAuth() {
            try {
                if (Object.keys(firebaseConfig).length === 0) {
                    console.error("Firebase config is missing. Cannot initialize Firebase.");
                    document.getElementById('user-id-display').querySelector('span').textContent = 'Error: Firebase Config Missing';
                    return;
                }
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                // Listen for auth state changes
                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                        document.getElementById('user-id-display').querySelector('span').textContent = userId;
                    } else {
                        // Sign in anonymously if no user is authenticated
                        if (!initialAuthToken) {
                            const anonymousUser = await signInAnonymously(auth);
                            userId = anonymousUser.user.uid;
                            document.getElementById('user-id-display').querySelector('span').textContent = userId;
                        } else {
                            // If there was an initialAuthToken but sign-in failed, use a random ID
                            userId = crypto.randomUUID();
                            document.getElementById('user-id-display').querySelector('span').textContent = userId + ' (Guest)';
                            console.warn("Authentication failed, using anonymous ID.");
                        }
                    }
                    isAuthReady = true; // Auth state is now ready
                });

                // Try to sign in with custom token if available
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    // If no custom token, onAuthStateChanged will handle anonymous sign-in
                }
                
            } catch (error) {
                console.error("Error initializing Firebase or authenticating:", error);
                document.getElementById('user-id-display').querySelector('span').textContent = 'Error Auth';
                userId = crypto.randomUUID(); // Fallback to a random ID
                isAuthReady = true; // Mark as ready even with error to avoid blocking app
            }
        }

        // --- Start of existing application logic ---
        const content = {
            ar: {
                title: "Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„ÙƒØ¨Ø±Ù‰ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙˆØ±ØªØ±ÙŠÙ‡Ø§Øª",
                nav_title: "Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„ÙƒØ¨Ø±Ù‰",
                hero_title: "Ø§Ø¯Ø®Ù„ Ø§Ù„Ø³Ø­Ø¨ ÙˆØ§Ø±Ø¨Ø­ Ø¨ÙˆØ±ØªØ±ÙŠÙ‡ ÙÙ†ÙŠ",
                hero_subtitle: "ÙØ±Øµ Ù…ØªØ¹Ø¯Ø¯Ø© Ù„Ù„ÙÙˆØ² ÙˆØ®ØµÙˆÙ…Ø§Øª Ø­ØµØ±ÙŠØ© Ù„ÙƒÙ„ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†. Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø© Ø§Ù„ØªÙŠ ØªÙ†Ø§Ø³Ø¨Ùƒ ÙˆØ§Ù†Ø¶Ù… Ø¥Ù„ÙŠÙ†Ø§ Ø§Ù„Ø¢Ù†!",
                categories_title: "Ø§Ø®ØªØ± ÙØ¦Ø© Ø§Ø´ØªØ±Ø§ÙƒÙƒ",
                cat_a_title: "Ø§Ù„ÙØ¦Ø© Ø£",
                cat_a_price: "5",
                currency: "Ø¯.Ù….",
                cat_a_draw: "ğŸŸï¸ <span class='font-bold'>Ø§Ù„Ø³Ø­Ø¨:</span> ÙØ§Ø¦Ø² ÙˆØ§Ø­Ø¯ Ù„ÙƒÙ„ 100 Ù…Ø´Ø§Ø±Ùƒ",
                cat_a_discount: "ğŸ’¸ <span class='font-bold'>Ø®ØµÙ…:</span> 25% Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙˆØ±ØªØ±ÙŠÙ‡ (Ù„Ù…Ø¯Ø© 15 ÙŠÙˆÙ…)",
                popular_badge: "Ø§Ù„Ø£ÙƒØ«Ø± Ø´ÙŠÙˆØ¹Ù‹Ø§",
                cat_b_title: "Ø§Ù„ÙØ¦Ø© Ø¨",
                cat_b_price: "10",
                currency: "Ø¯.Ù….",
                cat_b_draw: "ğŸ¯ <span class='font-bold'>Ø§Ù„Ø³Ø­Ø¨:</span> Ø¹Ù†Ø¯ ÙˆØµÙˆÙ„ 50 Ù…Ø´Ø§Ø±ÙƒÙ‹Ø§",
                cat_b_discount: "ğŸ’° <span class='font-bold'>Ø®ØµÙ…:</span> 35% Ø¹Ù„Ù‰ ÙƒÙ„ Ø·Ù„Ø¨ Ø¨ÙˆØ±ØªØ±ÙŠÙ‡",
                cat_c_title: "Ø§Ù„ÙØ¦Ø© Ø¨Ø±Ùˆ-Ù…Ø§ÙƒØ³",
                cat_c_price: "20",
                currency: "Ø¯.Ù….",
                cat_c_draw: "â­ <span class='font-bold'>Ø§Ù„Ø³Ø­Ø¨:</span> Ø¹Ù†Ø¯ Ø¨Ù„ÙˆØº 30 Ù…Ø´Ø§Ø±ÙƒÙ‹Ø§ ÙÙ‚Ø·",
                cat_c_discount: "ğŸ’ <span class='font-bold'>Ø®ØµÙ…:</span> 50% Ø¹Ù„Ù‰ Ø·Ù„Ø¨ Ø§Ù„Ø¨ÙˆØ±ØªØ±ÙŠÙ‡",
                charts_title: "Ù…Ù‚Ø§Ø±Ù†Ø© Ø¨ÙŠÙ† Ø§Ù„ÙØ¦Ø§Øª",
                chart1_title: "Ø§Ù„ØªÙƒÙ„ÙØ© Ù…Ù‚Ø§Ø¨Ù„ Ø§Ù„Ø®ØµÙ…",
                chart1_fee_label: "Ø±Ø³ÙˆÙ… Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ (Ø¯.Ù….)",
                chart1_discount_label: "Ù†Ø³Ø¨Ø© Ø§Ù„Ø®ØµÙ… (%)",
                chart2_title: "ÙØ±ØµØ© Ø§Ù„ÙÙˆØ² (Ù…Ø´Ø§Ø±ÙƒÙˆÙ† Ø£Ù‚Ù„ = ÙØ±ØµØ© Ø£ÙƒØ¨Ø±)",
                chart2_participants_label: "Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ† Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ù„Ù„Ø³Ø­Ø¨",
                chart_categories: ["Ø§Ù„ÙØ¦Ø© Ø£", "Ø§Ù„ÙØ¦Ø© Ø¨", "Ø§Ù„ÙØ¦Ø© Ø¨Ø±Ùˆ-Ù…Ø§ÙƒØ³"],
                join_title: "ÙƒÙŠÙ ØªØ´Ø§Ø±ÙƒØŸ",
                step1_title: "Ø§Ø®ØªØ± ÙØ¦ØªÙƒ",
                step1_desc: "Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø© Ø§Ù„ØªÙŠ ØªÙ†Ø§Ø³Ø¨Ùƒ Ù…Ù† Ø¨ÙŠÙ† Ø§Ù„ÙØ¦Ø§Øª Ø§Ù„Ø«Ù„Ø§Ø« Ø§Ù„Ù…ØªØ§Ø­Ø©.",
                step2_title: "ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§",
                step2_desc: "Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ ÙˆØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ù„Ø¥ØªÙ…Ø§Ù… Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¯ÙØ¹.",
                step3_title: "Ø§Ø¯Ø®Ù„ Ø§Ù„Ø³Ø­Ø¨!",
                step3_desc: "Ø¨Ù…Ø¬Ø±Ø¯ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¯ÙØ¹ØŒ Ø£Ù†Øª Ù…Ø´ØªØ±Ùƒ Ø±Ø³Ù…ÙŠÙ‹Ø§ ÙÙŠ Ø§Ù„Ø³Ø­Ø¨. Ø­Ø¸Ù‹Ø§ Ù…ÙˆÙÙ‚Ù‹Ø§!",
                footer_title: "Ù‡Ù„ Ø£Ù†Øª Ù…Ø³ØªØ¹Ø¯ Ù„Ù„Ø§Ù†Ø¶Ù…Ø§Ù…ØŸ",
                footer_subtitle: "ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ø§Ù„Ø¢Ù† Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ø¨Ø¯Ø¡ Ø§Ø´ØªØ±Ø§ÙƒÙƒ Ø£Ùˆ ØªØ§Ø¨Ø¹Ù†Ø§ Ø¹Ù„Ù‰ Ø§Ù†Ø³ØªØºØ±Ø§Ù…!",
                whatsapp_btn: "ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨",
                instagram_btn: "ØªØ§Ø¨Ø¹Ù†Ø§ Ø¹Ù„Ù‰ Ø§Ù†Ø³ØªØºØ±Ø§Ù…",
                // Inscription Page Content
                back_button_text: "Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©",
                inscription_title: "Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©",
                chosen_category_summary_title: "Ø§Ù„ÙØ¦Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©:",
                form_full_name_label: "Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„:",
                form_whatsapp_label: "Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨:",
                form_phone_label: "Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):",
                form_payment_proof_label: "ØµÙˆØ±Ø© Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ø¯ÙØ¹:",
                form_payment_proof_hint: "ÙŠØ±Ø¬Ù‰ Ø¥Ø±Ø³Ø§Ù„ ØµÙˆØ±Ø© ÙˆØ§Ø¶Ø­Ø© Ù„Ø¥ÙŠØµØ§Ù„ Ø§Ù„Ø¯ÙØ¹.",
                form_submit_button: "ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ",
                submission_success_title: "ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ø´ØªØ±Ø§ÙƒÙƒ Ø¨Ù†Ø¬Ø§Ø­!",
                submission_success_details: "Ù„Ù‚Ø¯ Ù‚Ù…Øª Ø¨Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙÙŠ ÙØ¦Ø© {categoryName} Ø¨Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ.",
                submission_contact_info: "Ø³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹ Ø¹Ù„Ù‰ Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ø°ÙŠ Ù‚Ø¯Ù…ØªÙ‡.",
                submission_error_title: "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„!",
                submission_error_details: "ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.",
                submission_loading_text: "Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ..."
            },
            en: {
                title: "Grand Prize Draw for Portraits",
                nav_title: "Grand Prize Draw",
                hero_title: "Enter the Draw & Win an Artistic Portrait",
                hero_subtitle: "Multiple chances to win and exclusive discounts for all participants. Choose your category and join us now!",
                categories_title: "Choose Your Subscription Category",
                cat_a_title: "Category A",
                cat_a_price: "5",
                currency: "MAD",
                cat_a_draw: "ğŸŸï¸ <span class='font-bold'>Draw:</span> 1 winner per 100 participants",
                cat_a_discount: "ğŸ’¸ <span class='font-bold'>Discount:</span> 25% on a portrait (for 15 days)",
                popular_badge: "Popular",
                cat_b_title: "Category B",
                cat_b_price: "10",
                currency: "MAD",
                cat_b_draw: "ğŸ¯ <span class='font-bold'>Draw:</span> When 50 participants are reached",
                cat_b_discount: "ğŸ’° <span class='font-bold'>Discount:</span> 35% on every portrait order",
                cat_c_title: "Category Pro-Max",
                cat_c_price: "20",
                currency: "MAD",
                cat_c_draw: "â­ <span class='font-bold'>Draw:</span> When only 30 participants are reached",
                cat_c_discount: "ğŸ’ <span class='font-bold'>Discount:</span> 50% on a portrait order",
                charts_title: "Category Comparison",
                chart1_title: "Cost vs. Benefit",
                chart1_fee_label: "Entry Fee (MAD)",
                chart1_discount_label: "Discount Percentage (%)",
                chart2_title: "Chance to Win (Fewer participants = Higher chance)",
                chart2_participants_label: "Participants Needed for Draw",
                chart_categories: ["Category A", "Category B", "Category Pro-Max"],
                join_title: "How to Join?",
                step1_title: "Choose Your Category",
                step1_desc: "Select the category that suits you best from the three available options.",
                step2_title: "Contact Us",
                step2_desc: "Click the WhatsApp button and contact us to complete the payment.",
                step3_title: "Enter the Draw!",
                step3_desc: "Once payment is confirmed, you are officially in the draw. Good luck!",
                footer_title: "Ready to Join?",
                footer_subtitle: "Contact us now on WhatsApp to start your subscription or follow us on Instagram!",
                whatsapp_btn: "Contact on WhatsApp",
                instagram_btn: "Follow on Instagram",
                // Inscription Page Content
                back_button_text: "Back to Main Page",
                inscription_title: "Competition Registration",
                chosen_category_summary_title: "Chosen Category:",
                form_full_name_label: "Full Name:",
                form_whatsapp_label: "WhatsApp Number:",
                form_phone_label: "Phone Number (Optional):",
                form_payment_proof_label: "Payment Proof Image:",
                form_payment_proof_hint: "Please upload a clear image of your payment receipt.",
                form_submit_button: "Confirm Subscription",
                submission_success_title: "Subscription Successful!",
                submission_success_details: "You have successfully registered for {categoryName} with your information.",
                submission_contact_info: "We will contact you shortly on the WhatsApp number you provided.",
                submission_error_title: "Registration Error!",
                submission_error_details: "Please ensure all required fields are filled.",
                submission_loading_text: "Submitting your data..."
            }
        };

        let currentLang = 'ar'; // Default language
        const langToggleButton = document.getElementById('lang-toggle');
        let costBenefitChart, chanceToWinChart;

        const mainView = document.getElementById('main-view');
        const inscriptionView = document.getElementById('inscription-view');
        const backToMainBtn = document.getElementById('back-to-main-btn');
        const categoryCards = document.querySelectorAll('.card-category');
        const inscriptionCategoryName = document.querySelector('[data-key="inscription_category_name"]');
        const inscriptionCategoryPrice = document.querySelector('[data-key="inscription_category_price"]');
        const inscriptionCategoryDiscount = document.querySelector('[data-key="inscription_category_discount"]');
        const inscriptionForm = document.getElementById('inscription-form');
        const submissionMessage = document.getElementById('submission-message');
        const submissionErrorMessage = document.getElementById('submission-error-message');
        const submissionLoadingMessage = document.getElementById('submission-loading-message');
        const submissionSuccessDetails = submissionMessage.querySelector('[data-key="submission_success_details"]');
        const userIdDisplay = document.getElementById('user-id-display').querySelector('span');

        function wrapLabel(label, maxChars = 16) {
            if (typeof label !== 'string') return label;
            const words = label.split(' ');
            let lines = [];
            let currentLine = '';

            words.forEach(word => {
                if ((currentLine + word).length > maxChars && currentLine.length > 0) {
                    lines.push(currentLine.trim());
                    currentLine = word + ' ';
                } else {
                    currentLine += word + ' ';
                }
            });
            lines.push(currentLine.trim());
            return lines;
        }

        function updateContent(lang) {
            document.querySelectorAll('[data-key]').forEach(element => {
                const key = element.getAttribute('data-key');
                if (content[lang][key]) {
                    element.innerHTML = content[lang][key];
                }
            });
            document.documentElement.lang = lang;
            document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
            langToggleButton.textContent = lang === 'ar' ? 'English' : 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©';
        }

        function createCharts(lang) {
            const chartData = content[lang];
            
            if (costBenefitChart) costBenefitChart.destroy();
            const ctx1 = document.getElementById('costBenefitChart').getContext('2d');
            costBenefitChart = new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels: chartData.chart_categories.map(label => wrapLabel(label)),
                    datasets: [
                        {
                            label: chartData.chart1_fee_label,
                            data: [5, 10, 20],
                            backgroundColor: 'rgba(129, 140, 248, 0.6)',
                            borderColor: 'rgba(129, 140, 248, 1)',
                            borderWidth: 1
                        },
                        {
                            label: chartData.chart1_discount_label,
                            data: [25, 35, 50],
                            backgroundColor: 'rgba(52, 211, 153, 0.6)',
                            borderColor: 'rgba(52, 211, 153, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    maintainAspectRatio: false,
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: '#374151'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#374151'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: '#374151'
                            }
                        },
                        tooltip: {
                            callbacks: {
                                title: function(context) {
                                    return context[0].label.replace(/,/g, ' ');
                                }
                            }
                        }
                    }
                }
            });

            if (chanceToWinChart) chanceToWinChart.destroy();
            const ctx2 = document.getElementById('chanceToWinChart').getContext('2d');
            chanceToWinChart = new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: chartData.chart_categories.map(label => wrapLabel(label)),
                    datasets: [{
                        label: chartData.chart2_participants_label,
                        data: [100, 50, 30],
                        backgroundColor: 'rgba(192, 132, 252, 0.6)',
                        borderColor: 'rgba(192, 132, 252, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',
                    maintainAspectRatio: false,
                    responsive: true,
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: {
                                color: '#374151'
                            }
                        },
                        y: {
                            ticks: {
                                color: '#374151'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: '#374151'
                            }
                        },
                        tooltip: {
                            callbacks: {
                                title: function(context) {
                                    return context[0].label.replace(/,/g, ' ');
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // View switching logic
        function showView(viewId) {
            document.querySelectorAll('.view-section').forEach(view => {
                view.classList.remove('active');
            });
            document.getElementById(viewId).classList.add('active');
            window.scrollTo(0, 0); // Scroll to top when changing view
        }

        // Event listeners
        langToggleButton.addEventListener('click', () => {
            currentLang = currentLang === 'ar' ? 'en' : 'ar';
            updateContent(currentLang);
            createCharts(currentLang); // Recreate charts to update labels/direction
        });

        categoryCards.forEach(card => {
            card.addEventListener('click', () => {
                const categoryType = card.dataset.category;
                let categoryName, categoryPrice, categoryDiscount;

                if (categoryType === 'A') {
                    categoryName = content[currentLang].cat_a_title;
                    categoryPrice = content[currentLang].cat_a_price + ' ' + content[currentLang].currency;
                    categoryDiscount = content[currentLang].cat_a_discount.replace(/<[^>]*>/g, ''); // Remove HTML tags
                } else if (categoryType === 'B') {
                    categoryName = content[currentLang].cat_b_title;
                    categoryPrice = content[currentLang].cat_b_price + ' ' + content[currentLang].currency;
                    categoryDiscount = content[currentLang].cat_b_discount.replace(/<[^>]*>/g, '');
                } else if (categoryType === 'C') {
                    categoryName = content[currentLang].cat_c_title;
                    categoryPrice = content[currentLang].cat_c_price + ' ' + content[currentLang].currency;
                    categoryDiscount = content[currentLang].cat_c_discount.replace(/<[^>]*>/g, '');
                }

                inscriptionCategoryName.textContent = categoryName;
                inscriptionCategoryPrice.textContent = categoryPrice;
                inscriptionCategoryDiscount.textContent = categoryDiscount;
                
                showView('inscription-view');
                // Update inscription page text after showing it
                updateContent(currentLang);
            });
        });

        backToMainBtn.addEventListener('click', () => {
            showView('main-view');
            // Recreate charts when returning to main view to ensure responsiveness
            createCharts(currentLang); 
            // Hide submission messages
            submissionMessage.classList.add('hidden');
            submissionErrorMessage.classList.add('hidden');
            submissionLoadingMessage.classList.add('hidden'); // Hide loading
            inscriptionForm.reset(); // Clear form fields
        });

        inscriptionForm.addEventListener('submit', async (event) => { // Make function async
            event.preventDefault(); // Prevent default form submission

            // Hide previous messages
            submissionMessage.classList.add('hidden');
            submissionErrorMessage.classList.add('hidden');
            submissionLoadingMessage.classList.remove('hidden'); // Show loading

            const fullName = document.getElementById('full-name').value;
            const whatsappNumber = document.getElementById('whatsapp-number').value;
            const phoneNumber = document.getElementById('phone-number').value;
            const paymentProofFile = document.getElementById('payment-proof').files[0]; // File object

            if (!fullName || !whatsappNumber || !paymentProofFile) {
                submissionErrorMessage.classList.remove('hidden');
                submissionLoadingMessage.classList.add('hidden');
                return;
            }

            if (!isAuthReady) {
                submissionErrorMessage.classList.remove('hidden');
                submissionErrorMessage.querySelector('[data-key="submission_error_details"]').textContent = content[currentLang].submission_error_details + " (Authentication not ready, please try again)";
                submissionLoadingMessage.classList.add('hidden');
                console.error("Firebase authentication not ready.");
                return;
            }

            try {
                // Ensure userId is available
                if (!userId) {
                    userId = auth.currentUser?.uid || crypto.randomUUID(); // Fallback if still null
                }
                
                const docData = {
                    fullName: fullName,
                    whatsappNumber: whatsappNumber,
                    phoneNumber: phoneNumber || null, // Null if optional field is empty
                    categoryName: inscriptionCategoryName.textContent,
                    categoryPrice: inscriptionCategoryPrice.textContent,
                    categoryDiscount: inscriptionCategoryDiscount.textContent,
                    paymentProofFileName: paymentProofFile ? paymentProofFile.name : null, // Only store file name
                    timestamp: new Date()
                };

                // Add document to Firestore
                // Path: /artifacts/{appId}/users/{userId}/subscriptions
                const subscriptionsCollectionRef = collection(db, `artifacts/${appId}/users/${userId}/subscriptions`);
                await addDoc(subscriptionsCollectionRef, docData);

                // Display success message
                let successMessageHtml = content[currentLang].submission_success_details.replace('{categoryName}', inscriptionCategoryName.textContent);
                submissionSuccessDetails.innerHTML = successMessageHtml;
                submissionMessage.classList.remove('hidden');
                
                inscriptionForm.reset(); // Clear form fields after successful submission

            } catch (error) {
                console.error("Error submitting to Firestore:", error);
                submissionErrorMessage.classList.remove('hidden');
                submissionErrorMessage.querySelector('[data-key="submission_error_details"]').textContent = content[currentLang].submission_error_details + " " + error.message;
            } finally {
                submissionLoadingMessage.classList.add('hidden'); // Hide loading
            }
        });


        // Initial setup on page load
        window.onload = () => {
            initializeFirebaseAndAuth(); // Initialize Firebase first
            updateContent(currentLang);
            createCharts(currentLang);
        };
    </script>
</body>
    </html>
